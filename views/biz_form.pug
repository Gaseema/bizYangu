extends layout

block content
  div(class="updateBizHero")
    if biz === undefined
        h1
            span#bizid(class="titleBlock") Create New Business
    else
        h1
            span#bizid(class="titleBlock" bizid=biz.id) Manage #{biz.biz_name}

  div(class="row" style="padding-top: 20px;width: 88%;")
    div(class="col-sm-12 col-md-3 leftPanel")
        div(class="adverts" style="background:white;width:100%;")
            div(style="border-bottom:solid 1px #d2d2d2;")
                p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Settings
            div()
                ul(style="padding-left: 10px; font-size: 0.9em;")
                    li Terms & Security
                    li Help
    div(class="col-sm-12 col-md-6 middlePanel")
        div(class="row updateBizForm")
          div(style="border-bottom:solid 1px #d2d2d2;")
            if biz === undefined
                p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Create Business
            else
                p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Update Your Businesses
          form(method='POST', action='',  enctype="multipart/form-data")
            div.form-group
              label(for='biz_name') Business Name:
              input#biz_name.form-control(autocomplete='off' type='text', placeholder='Business name (Duka) last' name='biz_name' required='true' value=(undefined===biz ? '' : biz.biz_name))
            div.form-group
                label(for='name') Business Category:
                  select#biz.form-control(type='select', placeholder='Select category' name='name' required='true' )
                    for category in categories
                      if biz
                        option(value=category._id selected=(category._id.toString()==biz.category ? 'selected' : false) ) #{category.name}
                      else
                        option(value=category._id) #{category.name}
            .row(style="margin-bottom: 0;")
              .input-field.col-sm-12(style="margin-bottom: 0;")
                input#autocomplete-input.bizLocation(autocomplete="off" type='text' placeholder="Enter location" required="true" name="location" value=(undefined===biz ? '' : biz.location))
                label(for='autocomplete-input') Location
            .row
              .input-field.col-sm-12
                input#first_name.validate(autocomplete="on" placeholder='Enter Phone Number', type='number' required="true" name="phoneNo" value=(undefined===biz ? '' : biz.phoneNo))
                label(for='first_name') Phone Number

            .file-field.input-field
                .btn(class="regularBtn")
                  span File
                  input(name='myImage' type='file')
                .file-path-wrapper
                  input.file-path.validate(type='text')
            p(style="color:red;") #{errors}
            button.btn.btn-primary(type='submit' class="regularBtn") Submit

        if biz === undefined
        else
            div(class="row getBizCategories")
                div(style="border-bottom:solid 1px #d2d2d2;")
                    p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Manage Categories For This Business
                div(class="row")
                    div(class="col-sm-9")
                        div.form-group
                            if biz === undefined
                            else
                                div(id="getBizId" style="display:none;") #{biz.id}
                            label(for='prodCatName') Product Category:
                            input#name.form-control(class="prodCatInput" type='text', placeholder='Add categories' name='prodCatName')
                    div(class="col-sm-3")
                        button(class="regularBtn btn" id="addPrdCat" style="margin-top:20px;" onclick="addProdCat();") +
                div(class="populateBizCategory")
                    if biz === undefined
                    else
                        each category in bizs_categories
                            .chip.deletePrdCat(id=category._id style="cursor: -webkit-grab;")
                              | #{category.name}
                              span(style="padding-left: 10px; font-size: 1.3em;") x
                        else
                            p This business has no categories :(

        if biz === undefined

        else
            div(class="row getBizProducts")
                div(style="border-bottom:solid 1px #d2d2d2;")
                    p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Manage Products For This Business
                div(class="row productHolder")
                    each products in biz_products
                        div(class="col-sm-6 col-md-4")
                            div(class="card")
                                div
                                    img(style="width:100%; height:100px;object-fit: contain;" src=/uploads/+products.product_pic)
                                div
                                    p(style="margin: 0px 0px 5px 10px;;") #{products.product_name}
                                div(class="productHolderBtn" style="text-align:center;")
                                    a(href='/product/'+products.id+'/update' class="btn regularBtn" style="display: block; width: 100%;") edit
                    else
                        |This business has no products
    div(class="col-sm-12 col-md-3 rightPanel")
        div(style="width:100%;")
            if biz === undefined
            else
                div(style="text-align:center;")
                    div(style="margin-bottom: 10px; background: white; border-radius: 3px;")
                        div(style="border-bottom:solid 1px #d2d2d2;")
                            p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Create New Product
                        a(href="/product/create" class="btn regularBtn" style="margin:15px;") create
                    div(style="margin-bottom: 10px; background: white; border-radius: 3px;")
                        div(style="border-bottom:solid 1px #d2d2d2;")
                            p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Create New Businesses
                        a(href="/biz/create" class="btn regularBtn" style="margin:15px;") create
                    div(style="margin-bottom: 10px; background: white; border-radius: 3px;")
                        div(style="border-bottom:solid 1px #d2d2d2;")
                            p(style="margin: 0px; padding: 2px 10px; font-size: 1.2em;") Delete Your Businesses
                        a(href="/biz/"+biz.id+"/delete" class="btn redBtn" style="margin:15px;") delete

  if errors
    ul
      for error in errors
        li!= error.msg
  script
      include ../public/javascripts/biz.js
